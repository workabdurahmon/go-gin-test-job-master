# Тестовое задание:
**Доработать мини-сервер с использованием Go, MySQL, GORM, Gin, OpenAPI (Swagger).**


**Задание состоит из двух частей**:
- _1-я часть Homework_ - в домашней обстановке нужно разобраться со структурой проекта, тестами,
  а также рекомендуется выполнить ряд не сложных задач по использованию вышеописанных технологий.
  Выполнение рекомендованных задач позволит глубже разобраться с проектом и упростит прохождение 2-й части Live coding.
  Данная часть задания будет описана в данном документе.

- _2-я часть Live coding_ - в режиме реального времени нужно будет выполнить несколько несложных задач.
  Данная часть задания будет выдаваться при очном собеседовании.

**Обратите внимание:** Мы подготовили шаблон серверного проекта на фреймворке Gin с использованием GORM.
В данном шаблоне реализованы базовые модули, контролеры и сервисы.
Также реализовано 3 метода в контролерах, полноценно покрытыми интеграционными тестами.
Интеграционные тесты помогут в понимании назначения проекта.

**Обратите внимание:** Для выполнения задания не нужно запускать сервер и подключаться к реальной базе данных.
Тестирование должно проводиться через запуск интеграционных тестов.


**Описание заданий 1-й части Homework:**

_1. Разобраться со структурой проекта и тестами._

1.1. Убедиться, что используем Go версии 1.23.
```bash
    $ go version
```

1.2. Установить пакеты
```bash
    $ go install github.com/swaggo/swag/cmd/swag@latest
    $ go install github.com/cespare/reflex@latest
```

1.3. Установить зависимости
```bash
    $ go mod vendor
``` 

1.4. Сгенерировать OpenAPI (Swagger) документацию
```bash
    $ swag init
``` 

1.5. Установить/запустить mysql server (используем в тестах).

Способ 1:

- установить docker: `https://docs.docker.com/get-docker/`;
- запустить под админом (пользователем с привилегированными правами) скрипт: `docker start db-test || docker run -d -p 3406:3306 --env MYSQL_ROOT_PASSWORD=root_password --name db-test --rm mysql:latest`;
- в `.env` файле не заполнять подключение к тестовой БД (значения по умолчанию соответсвуют параметрам запуска контейнера mysql).

Способ 2:

- установить mysql сервер: `https://dev.mysql.com/doc/mysql-installation-excerpt/5.7/en/`;
- создать пользователя mysql с админскими правами;
- в `.env` файле заполнить подключение к тестовой БД.

1.6. Создать `.env` файл.
```bash
    APP_NAME={YOUR_APP_NAME} # не обязательный параметр, значение по умолчанию `TestApp`
    APP_HOST={YOUR_APP_HOST} # не обязательный параметр, значение по умолчанию `undefined`
    PORT={YOUR_APP_PORT} # не обязательный параметр, значение по умолчанию `3000`
    IS_DEBUG={IS_DEBUG} # не обязательный параметр, значение по умолчанию `true`
    ADMIN_X_API_KEY={ADMIN_X_API_KEY} # обязательный параметр, подойдет любая не пустая строка 
    CRON_X_API_KEY={CRON_X_API_KEY} # обязательный параметр, подойдет любая не пустая строка
    REQUEST_TIMEOUT_SEC={REQUEST_TIMEOUT_SEC} # не обязательный параметр, значение по умолчанию `20`

    # параметры для подключения mysql, обязательные для запуска приложения, в тестах не используются 
    DB_HOST={DB_HOST} # не обязательный параметр, значение по умолчанию `localhost`
    DB_PORT={DB_PORT} # не обязательный параметр, значение по умолчанию `3306`
    DB_USERNAME={DB_USERNAME} # не обязательный параметр, значение по умолчанию `username`
    DB_PASSWORD={DB_PASSWORD} # не обязательный параметр, значение по умолчанию `password`
    DB_SCHEMA={DB_SCHEMA} # не обязательный параметр, значение по умолчанию `database`

    # параметры для подключения mysql, обязательные для запуска тестов, для запуска приложения не используются 
    TEST_DB_HOST={TEST_DB_HOST} # не обязательный параметр, значение по умолчанию `localhost`
    TEST_DB_PORT={TEST_DB_PORT} # не обязательный параметр, значение по умолчанию `3406`
    TEST_DB_USERNAME={TEST_DB_USERNAME} # не обязательный параметр, значение по умолчанию `root`
    TEST_DB_PASSWORD={TEST_DB_PASSWORD} # не обязательный параметр, значение по умолчанию `root_password`
    TEST_DB_SCHEMA={TEST_DB_SCHEMA} # не обязательный параметр, значение по умолчанию `server`
``` 

1.7. Запустить тесты - если все настроено корректно должны пройти все 18 тестов:
```bash
    $ go test -v
```


_2. Рекомендуемые задачи для выполнения._

_2.1 Доработать сущность: account._
Добавить в сущность `account` 3 новых поля:
- `name` (varchar(255)),
- `rank` (tinyint, from 0 to 100),
- `memo` (text, nullable).

_2.2. Доработать существующий метод GET /account_ - метод для получения списка аккаунтов с пагинацией.

2.2.1. В dto `AccountDto` добавить 3 новых поля.

2.2.2. Добавить опциональный параметр - поле `search`. По данному полю ищем совпадения в полях `address`, `name` и `memo` таблицы `account`.

2.2.3. Добавить возможность сортировать не только по `id` или `updated_at`, но и по полям `address`, `name` и `rank`.

2.2.4. Подправить интеграционные тесты. При корректировке учесть все вышеописанные изменения.

_2.3. Доработать метод POST /account_ - метод для создания нового аккаунта в таблице account.

2.3.1. В `body` метода добавить 3 новых поля: поле `memo` - опциональное, остальные поля `name` и `rank` обязательные. Обязательно валидировать новые поля.

2.3.2. При создании нового аккаунта в таблице `account` учесть новые параметры из `body`.

2.3.3. Подправить интеграционные тесты. При корректировке учесть все вышеописанные изменения.

_2.4. Скорректировать OpenAPI (Swagger) документацию для отражения в ней всех вышеописанных изменений._
